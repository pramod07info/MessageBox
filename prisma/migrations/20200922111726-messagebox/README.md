# Migration `20200922111726-messagebox`

This migration has been generated by TUSHAR KHARAT at 9/22/2020, 4:47:26 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."conversation" (
"id" SERIAL,
"fromUser" integer   ,
"toUser" integer   ,
"created" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."message" (
"id" SERIAL,
"conversationId" integer   NOT NULL ,
"message" text   NOT NULL ,
"userId" integer   ,
"created" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."user" (
"id" SERIAL,
"userName" text   NOT NULL ,
"fullName" text   NOT NULL ,
"email" text   NOT NULL ,
"picture" text   NOT NULL ,
"role" text   NOT NULL ,
"created" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "user.userName_unique" ON "public"."user"("userName")

ALTER TABLE "public"."conversation" ADD FOREIGN KEY ("fromUser")REFERENCES "public"."user"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."conversation" ADD FOREIGN KEY ("toUser")REFERENCES "public"."user"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."message" ADD FOREIGN KEY ("conversationId")REFERENCES "public"."conversation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."message" ADD FOREIGN KEY ("userId")REFERENCES "public"."user"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200921182733-init..20200922111726-messagebox
--- datamodel.dml
+++ datamodel.dml
@@ -1,11 +1,41 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
+generator client {
+  provider = "prisma-client-js"
+}
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-generator client {
-  provider = "prisma-client-js"
+model conversation {
+  id                               Int       @default(autoincrement()) @id
+  fromUser                         Int?
+  toUser                           Int?
+  created                          DateTime?
+  user_conversation_fromUserTouser user?     @relation("conversation_fromUserTouser", fields: [fromUser], references: [id])
+  user_conversation_toUserTouser   user?     @relation("conversation_toUserTouser", fields: [toUser], references: [id])
+  message                          message[]
 }
+
+model message {
+  id             Int          @default(autoincrement()) @id
+  conversationId Int
+  message        String
+  userId         Int?
+  created        DateTime?
+  conversation   conversation @relation(fields: [conversationId], references: [id])
+  user           user?        @relation(fields: [userId], references: [id])
+}
+
+model user {
+  id                                       Int            @default(autoincrement()) @id
+  userName                                 String         @unique
+  fullName                                 String
+  email                                    String
+  picture                                  String
+  role                                     String
+  created                                  DateTime       @default(now())
+  conversation_conversation_fromUserTouser conversation[] @relation("conversation_fromUserTouser")
+  conversation_conversation_toUserTouser   conversation[] @relation("conversation_toUserTouser")
+  message                                  message[]
+}
```


